vasconian_mission_01 = {
    header = "mission_image_general" # SPECIAL FIELD - Sets top picture for the mission
    icon = "general_3" # SPECIAL FIELD - Sets icon for the mission

    repeatable = no # SPECIAL FIELD - Sets if a mission can be done once or several times

    chance = {
        factor = 50000
    } # SPECIAL FIELD - Sets the chances of a mission appearing in your list of available missions

    potential = {
        NOT = { has_variable = vasconian_mission_cooldown }
        #primary_culture = talaiotic # TRIGGER FIELD - Sets the conditions for the mission to appear in your list
        tag = VSC
        is_subject = no # must not be a subject
    }
    on_start = {
        save_scope_as = me_vasconian_scope
        start_mission_ai_effect = yes
    } # EFFECT FIELD - These effects are run when the mission is started

    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = vasconian_mission_cooldown
            days = 1 #7300
        }
    } # EFFECT FIELD - These effects are run when the mission is aborted

    abort = {
        ai_mission_back_out_trigger = yes
    }

    on_completion = {
        complete_mission_effect = yes
    } # EFFECT FIELD - These effects are run when the mission is completed



    vasconian_mission_01_task_01 = { # task 1 - The Pyrenean Pass
        icon = "task_battle"

        allow = {
            invention = global_defensive_inv_4
            p:1076 = {
                has_city_status = yes
                num_of_fortress_building >= 1
            }
        }

        on_start = {
        }

        highlight = {
            scope:province = {
                province_id = 1076
            }
        }

        on_completion = {
            show_as_tooltip = {
                p:1076 = {
                    add_permanent_province_modifier = {
                        name = pyrenean_pass
                    }
                }
                add_innovation = 4
                add_centralization = 5

                p:1076 = {
                    add_building_level = fortress_building
                    add_building_level = forum_building
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                }
            }
            trigger_event = { id = me_vasconian.1 }
        }
    }

    vasconian_mission_01_task_02 = { # task 2 - Setting Sights on the Atlantic
        icon = "task_battle"

        allow = {
        }

        duration = 60

        on_start = {
            trigger_event = { id = me_vasconian.2 } # Todo event chain
        }

        highlight = {
            scope:province = {
                AND = {
                    has_owner = yes
                    owner = c:VAD
                }
            }
        }

        on_completion = {
            custom_tooltip = vasconian_mission_01_task_02_tt
        }
    }

    vasconian_mission_01_task_03 = { # task 3 - The Mountain People
        icon = "task_battle"

        allow = {
            has_law = increased_council_powers
            custom_tooltip = {
                text = vasconian_mission_01_task_03_tt
                    any_owned_province = {
                        count >= 3
                        has_city_status = no
                        OR = {
                            terrain = hills
                            terrain = mountain
                            terrain = forest
                        }
                        has_building = hill_fort # Tribal settlement
                    }
            }
        }

        on_start = {
            trigger_event = { id = me_vasconian.3 } # Todo event chain
        }

        duration = 60

        # How to highlight certain territories with specific terrains within a nation
        highlight = {
            scope:province = {
                AND = {
                    has_owner = yes
                    owner = c:VSC
                    OR = {
                        terrain = hills
                        terrain = mountain
                        terrain = forest
                    }
                }
            }
        }

        on_completion = {
            custom_tooltip = vasconian_mission_01_task_03_tt_2
            show_as_tooltip = {
            }
        }
    }

    vasconian_mission_01_task_04 = { # task 4 - Raiding Iacetani
        icon = "task_battle"
        requires = { vasconian_mission_01_task_01 }

        allow = {
            invention = cohort_reinforcement_speed_inv
            p:1076 = {
                num_of_military_building >= 1
            }
        }

        duration = 365

        on_start = {
            trigger_event = { id = me_vasconian.4 } # Todo event chain
            # Create a new culture??
        }

        highlight = {
            scope:province = {
                province_id = 1076
            }
        }

        on_completion = {
            show_as_tooltip = {
            }
        }
    }

    vasconian_mission_01_task_05 = { # task 5 - Contact with the Aquitani
        icon = "task_battle"
        requires = { vasconian_mission_01_task_01 }

        allow = {
            custom_tooltip = {
                text = vasconian_mission_01_task_05_tt
                any_country = {
                    count >= 3
                    has_land = yes
                    primary_culture = aquitani
                    is_subject = no
                    capital_scope = {
                        OR = {
                            is_in_region = aquitaine_region
                            is_in_region = transalpine_gaul_region
                        }
                    }
                    AND = {
                        alliance_with = root
                        opinion = { target = root value > 65 }
                    }
                }
            }
        }

        on_start = {
        }

        on_completion = {
            show_as_tooltip = {
                # Move this to the event so that for each alliance we can get 5 pops
                # TODO integrate the aquitani culture within the event
                # look at fezzani.20  event
                show_as_tooltip = {
                    p:1076 = {
                        while = {
                            count = 5
                            define_pop = {
                                type = freemen
                                culture = aquitani
                                religion = root.religion
                            }
                        }
                    }
                }
            }
            trigger_event = { id = me_vasconian.5 }
        }
    }

    vasconian_mission_01_task_06 = { # task 6 - Chief City of the Vascones
        icon = "task_battle"
        requires = { vasconian_mission_01_task_02 }

        allow = {
            invention = global_tax_modifier_inv_1
            owns = 1078
            p:1078 = {
                has_city_status = yes
                total_population >= 15 # check population size within a territory
                civilization_value >= 20
            }
        }

        on_start = {
            trigger_event = { id = me_vasconian.6 } # Todo event chain
        }

        duration = 365

        highlight = {
            scope:province = {
                province_id = 1078
            }
        }

        on_completion = {
            show_as_tooltip = {
            }
        }
    }

    vasconian_mission_01_task_07 = { # task 7 - A Capital Stronghold
        icon = "task_battle"
        requires = { vasconian_mission_01_task_03 }

        allow = {
            has_law = increased_council_powers
            invention = centralised_production_inv
            p:1016 = {
                has_city_status = yes
                total_population >= 15
                num_of_fortress_building >= 2
                num_of_military_building >= 1
            }
        }

        highlight = {
            scope:province = {
                province_id = 1016
            }
        }

        on_start = {
        }

        on_completion = {
            show_as_tooltip = {
                add_military_experience = 50
                p:1016 = {
                    add_permanent_province_modifier = {
                        name = capital_stronghold
                    }
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = citizen
                }
            }
            trigger_event = { id = me_vasconian.7 }
        }
    }

    vasconian_mission_01_task_08 = { # task 8 - Arditurri Mines
        icon = "task_battle"
        requires = { vasconian_mission_01_task_06 }

        allow = {
            owns = 1017
            hidden:p:1017 = { # ??
                has_building = slave_mine_building # mine
                num_goods_produced >= 2
            }
        }

        on_start = {
        }

        highlight = {
            scope:province = {
                province_id = 1017
            }
        }

        on_completion = {
            show_as_tooltip = {
                add_treasury = 150
                add_political_influence = 35
                p:1017 = {
                    add_permanent_province_modifier = {
                        name = arditurri_mines
                    }
                }
            }
            trigger_event = { id = me_vasconian.8 }
        }
    }

    vasconian_mission_01_task_09 = { # task 9 - The Love Of Mari
        icon = "task_battle"
        requires = { vasconian_mission_01_task_06 }

        allow = {
        }

        on_start = {
        }

        on_completion = {
            show_as_tooltip = {
            }
            trigger_event = { id = me_vasconian.9 }
        }
    }

    vasconian_mission_01_task_10 = { # task 10 - Mountain Training
        icon = "task_battle"
        requires = { vasconian_mission_01_task_06 vasconian_mission_01_task_07 }

        allow = {
        }

        on_start = {
        }

        on_completion = {
            show_as_tooltip = {
            }
            trigger_event = { id = me_vasconian.10 }
        }
    }

    vasconian_mission_01_task_11 = { # task 11 - The Vasconium Agrum
        icon = "task_battle"
        requires = { vasconian_mission_01_task_07 }

        allow = {
        }

        on_start = {
        }

        on_completion = {
            show_as_tooltip = {
            }
            trigger_event = { id = me_vasconian.11 }
        }
    }

    vasconian_mission_01_task_12 = { # task 12 - A Call to all Barscunes
        icon = "task_battle"
        requires = { vasconian_mission_01_task_09 }

        allow = {
        }

        on_start = {
        }

        on_completion = {
            show_as_tooltip = {
            }
            trigger_event = { id = me_vasconian.12 }
        }
    }

    vasconian_mission_01_task_13 = { # task 13 - Pyrenean Dominance
        icon = "task_battle"
        requires = { vasconian_mission_01_task_10 }

        allow = {
        }

        on_start = {
        }

        on_completion = {
            show_as_tooltip = {
            }
            trigger_event = { id = me_vasconian.13 }
        }
    }

    vasconian_mission_01_task_14 = { # task 14 - Identity of the Barscunes
        icon = "task_battle"
        requires = { vasconian_mission_01_task_05 vasconian_mission_01_task_12 }

        allow = {
        }

        on_start = {
        }

        on_completion = {
            show_as_tooltip = {
            }
            trigger_event = { id = me_vasconian.14 }
        }
    }

    vasconian_mission_01_task_15 = { # task 15 - True Lords of the Ebro
        icon = "task_battle"
        requires = { vasconian_mission_01_task_12 }

        allow = {
        }

        on_start = {
        }

        on_completion = {
            show_as_tooltip = {
            }
            trigger_event = { id = me_vasconian.15 }
        }
    }

    vasconian_mission_01_task_16 = { # task 16 - The Ebro Confederation
        icon = "task_battle"
        requires = { vasconian_mission_01_task_13 vasconian_mission_01_task_15 }

        final = yes

        allow = {
        }

        on_start = {
        }

        on_completion = {
            show_as_tooltip = {
            }
            trigger_event = { id = me_vasconian.16 }
        }
    }



} # Final