tartessia = {
	icon = cde_greek_house
	header = mission_image_generic_greek

	repeatable = no

	chance = {
		factor = 10
	}

	ai_chance = { factor = 10 }

	potential = {
    	primary_culture = turdetanian
		is_subject = no
    	NOT = { has_variable = tartessia_mission_cooldown }	
		NOT = { tag = TAT }	
    }

	abort = {
		OR = {
			ai_mission_back_out_trigger = yes
			any_country = {
				NOT = {
					has_variable = doing_tartessia_mission
				}
				tag = TAT
			}
		}
	}

	on_start = {
    	start_mission_ai_effect = yes
	    set_variable = doing_tartessia_mission
    }

    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = tartessia_mission_cooldown
            days = 7300
        }
    }
 
	on_completion = {
		add_1_free_province_investments = yes
        complete_mission_effect = yes
    }

	tartessia_mission_inv_1_task = { #Heirs Of Tartessia
		icon = task_political
		duration = 90

		requires = {}

		highlight = {
			scope:province = {
				OR = {
					is_in_area = turdetania_occidentalis_area
					is_in_area = baetica_hispalensis_area
					is_in_area = gaditanus_area
					province_id = 1339
					province_id = 1340
					province_id = 1342
					province_id = 1343
					province_id = 1346
					province_id = 1349
					province_id = 1350
					province_id = 1351
					province_id = 1352
					province_id = 1364
					province_id = 1372
					province_id = 1373
					province_id = 1377
				}
			}
		}

		allow = {
			political_influence >= 25
		}

		on_completion = {
			add_political_influence = -25
			area:turdetania_occidentalis_area = {
				add_provincial_claim_effect = yes
			}
			area:baetica_hispalensis_area = {
				add_provincial_claim_effect = yes
			}
			area:gaditanus_area = {
				add_provincial_claim_effect = yes
			}
			p:1339 = {
				add_claim = root
			}
			p:1340 = {
				add_claim = root
			}
			p:1372 = {
				add_claim = root
			}
			p:1373 = {
				add_claim = root
			}
			p:1377 = {
				add_claim = root
			}
			trigger_event = me_tartessia.1
		}
	}

	tartessia_mission_inv_2_task = { #Carthaginian Contacts
		icon = task_expansion
		duration = 90

		requires = {tartessia_mission_inv_3_task}

		highlight = {
			scope:province = {
				province_id = 3061
			}
        }

		allow = {
			num_of_ships >= 5 
			hidden:p:3061.governor = {
				is_friend = root.current_ruler
			}
		}

		on_completion = {
			add_country_modifier = {
				name = carthaginian_turdetanian_connection_mod
				duration = 3650
			}
			trigger_event = me_tartessia.2

		}
	}

	tartessia_mission_inv_3_task = { #Restore The Mines Of Tharsis
		icon = task_economical

		requires = {}

		highlight = {
			scope:province = {
				owner = root
				OR = {
					trade_goods = precious_metals
					trade_goods = iron
					trade_goods = base_metals
					trade_goods = stone
				}
			}
		}

		allow = {
			custom_tooltip = {
				text = have_mine_tartessia_tt
				any_owned_province = {
					count >= 1
					has_building = slave_mine_building
				}
			}
		}

		on_completion = {
			random_owned_province = {
                limit = { num_of_slave_mine_building >= 1 }
                add_province_modifier = {
                    name = mines_of_tharsis_turdetania_mod
                    duration = -1
                }
            }
			add_country_modifier = {
				name = tharsis_mines_iron_boom
				duration = 3650
			}
			trigger_event = me_tartessia.3
			}
	}

	tartessia_mission_inv_4_task = { #North Of The Baetis
		icon = task_conquest

		requires = {tartessia_mission_inv_1_task}

		highlight = {
			scope:province = {
				OR = {
					is_in_area = turdetania_occidentalis_area
					province_id = 1339
					province_id = 1340
					province_id = 1372
					province_id = 1373
					
				}
			}
		}

		allow = {
			owns_or_subject_owns_area = turdetania_occidentalis_area
			owns_or_subject_owns = 1339
			owns_or_subject_owns = 1340
			owns_or_subject_owns = 1372
			owns_or_subject_owns = 1373
		}

		on_completion = {			
			add_stability = 5
			add_country_modifier = {
				name = turdetanian_aggression_mod
				duration = 1095
			}
			current_ruler = {
				add_popularity = 15
			}
			trigger_event = me_tartessia.4
		}
	}

	tartessia_mission_inv_5_task = { #Southernmost Iberia
		icon = task_expansion

		requires = {tartessia_mission_inv_1_task}

		highlight = {
			scope:province = {
				OR = {
					is_in_area = baetica_hispalensis_area
					province_id = 1342
					province_id = 1343
					province_id = 1351
					province_id = 1346
					province_id = 1352
					province_id = 1349
					province_id = 1350
					province_id = 1364
				}
			}
		}

		allow = {
			owns_or_subject_owns_area = baetica_hispalensis_area
			owns_or_subject_owns = 1342
			owns_or_subject_owns = 1343
			owns_or_subject_owns = 1351
			owns_or_subject_owns = 1346
			owns_or_subject_owns = 1352
			owns_or_subject_owns = 1349
			owns_or_subject_owns = 1350
			owns_or_subject_owns = 1364
		}

		on_completion = {
			add_treasury = 100
			add_country_modifier = {
				name = five_turdenian_cities_mod
				duration = 3650
			}
			current_ruler = {
				add_martial = 1
			}
			trigger_event = me_tartessia.5
		}
	}

	tartessia_mission_inv_6_task = { #The Bull Of Porcuna
		icon = task_artemis

		requires = {}

		highlight = {
			scope:province = {
				province_id = 1377
			}
        }

		allow = {
			treasury >= 35
			owns_or_subject_owns = 1377
			hidden:p:1377 = {
				dominant_province_religion = animism
				is_importing_trade_good = stone
				has_city_status = yes
				is_holy_site = yes
			}
		}

		on_completion = {
			add_treasury = -35
			create_country_treasure = {
				key = "bull_of_porcuna"
				icon = "treasure_it_gurzil_magical_bull" 
				modifier = {
					local_manpower_modifier = 0.05
					local_defensive = 0.05
				}
			}
			trigger_event = me_tartessia.6	
		}
	}

	tartessia_mission_inv_7_task = { #Greek Trading Connections
		icon = task_happiness

		requires = {tartessia_mission_inv_3_task}

		allow = {
			hidden:capital_scope = {
				has_city_status = yes
				num_of_commerce_building >= 3 
			}
			capital_scope.state = {
				calc_true_if = {
					amount >= 1   
					state_improvement_civic_trigger = yes  
				}
			}
			}

		on_completion = {
			capital_scope = {
				add_province_modifier = {
					name = greek_trade_connection_turdetania_mod
					duration = -1
				}
			}
			trigger_event = me_tartessia.7
		}
	}

	tartessia_mission_inv_8_task = { #Civilizing Baetica
		icon = task_battle

		requires = {tartessia_mission_inv_2_task tartessia_mission_inv_7_task}

		highlight = {
			scope:province ={
				owner = root
				is_capital = yes
			}
		}

		allow = {
			capital_scope = {
				is_importing_trade_good = precious_metals
				civilization_value >= 35
				num_of_academy_building >= 1
				num_of_library_building >= 1
				num_of_used_building_slots >= 1      
			}
		}

		on_completion = {
			add_2_free_province_investments = yes
			current_ruler = {
				add_trait = scholar
			}
			capital_scope = {
				add_building_level = forum_building
				add_province_modifier = {
					name = turdetanian_coin_mint_mod
					duration = -1
				}
			}
			trigger_event = me_tartessia.8	
		}
	}

	tartessia_mission_inv_9_task = { #The Harvest Festival
		icon = task_religion
		duration = 30

		requires = {tartessia_mission_inv_6_task}

		allow = {
			political_influence >= 10 
			war = no
			capital_scope = {
				is_importing_trade_good = horses
				is_importing_trade_good = wine
			}
			custom_tooltip = {
                text = 01_sw_britain_dum_12_philosopher
                any_character = {
					OR = {
						has_office = office_high_priest_monarchy
						has_office = office_high_priest
					}
                    zeal >= 9
                }
            }
		}

		highlight = {
			scope:province = {
				province_id = 358
			}
        }

		on_completion = {
			trigger_event = me_tartessia.9
			add_political_influence = -10
			current_ruler = {
				add_zeal = 1
			}
		}
	}

	tartessia_mission_inv_10_task = { #Rebirth of Tartessia
		icon = task_atlas
		final = yes

		requires = {tartessia_mission_inv_4_task tartessia_mission_inv_5_task}

		highlight = {
			scope:province = {
				OR = {
					is_in_area = turdetania_occidentalis_area
					is_in_area = baetica_hispalensis_area
					province_id = 1339
					province_id = 1340
					province_id = 1342
					province_id = 1343
					province_id = 1346
					province_id = 1349
					province_id = 1350
					province_id = 1351
					province_id = 1352
					province_id = 1364
					province_id = 1372
					province_id = 1373
					province_id = 1377
				}
			}
		}

		allow = {
			custom_tooltip = {
                text = you_need_to_reform_tartessia_tt
                tag = TAT
            }
		}

		on_completion = {
			current_ruler = {
				add_trait = conqueror
			}
			add_country_modifier = {
				name = "mighty_tartessia"
				duration = -7300
			}
			trigger_event = me_tartessia.10
		}
	}
}
