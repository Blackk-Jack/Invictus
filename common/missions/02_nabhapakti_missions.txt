nabhapakti_missions = {
    header = "indian_mission_header"
    icon = "india_3"

    repeatable = no
    chance = 1000

    potential = {
        NOT = { has_variable = mission_cooldown_var }
        tag = NBP
    }

    abort = {}
    on_start = {
        start_mission_ai_effect = yes
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = mission_cooldown_var
            days = 7300
        }
    }
    on_completion = {}
    nabhapakti_missions_task_1 = { # Made of Hundreds of Flowers
        icon = "task_happiness"
        duration = 100
        allow = {
            current_ruler = {
                popularity >= 65
            }
        }
        on_start = {
            trigger_event = me_nabhapakti.101
        }
        on_completion = {
            trigger_event = me_nabhapakti.1
            show_as_tooltip = {
                add_treasury = 150
                add_political_influence = 75
                add_stability = 10
                current_ruler = {
                    add_popularity = popularity_medium
                }
                add_2_free_province_investments = yes
            }
        }
    }
    nabhapakti_missions_task_2 = { # Into The Dragons Mouth
        icon = "task_shiva"
        allow = {
            custom_tooltip = {
                any_country = {
                    tag = MRY
                    opinion = {
                        target = root 
                        value >= 85
                    }
                }
                text = "nepali_maurya_opinion_tt"
            }
        }
        highlight = {
            scope:province = {
                owner = c:MRY
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti.2
            show_as_tooltip = {
                c:MRY = {
                    make_subject = {
                        target = c:NBP
                        type = vassal_tribe
                    }
                    add_opinion = {
                        target = c:NBP
                        modifier = opinion_loyal_subject
                    }
                }
                add_stability = 5
            }
        }
    }
    nabhapakti_missions_task_3 = { # Legacy of Shakya
        icon = "task_political"
        requires = { nabhapakti_missions_task_1 }
        bypass = {
            has_completed_mission_task = nabhapakti_missions_task_4
        }
        allow = {
            centralization >= 25
            p:4450 = {
                is_state_capital = yes
            }
            political_influence >= 35
        }
        on_completion = {
            trigger_event = me_nabhapakti.3
            show_as_tooltip = {
                add_country_modifier = {
                    name = shakya_legacy
                    duration = -1
                }
                change_country_color = shakya_yellow
                change_country_adjective = "shakyan"
                change_country_name = shakya_republic
                add_centralization = centralization_gargantuan
                add_stability = -3
                add_political_influence = -35
                change_government = tribal_federation
                if = {
                    limit = {
                        p:4450 = {
                           has_city_status = settlement
                        }
                    }
                    p:4450 = {
                        set_city_status = city
                    }
                }
            }
        }
    }
    nabhapakti_missions_task_4 = { # King of the Nepali
        icon = "task_expansion"
        requires = { nabhapakti_missions_task_1 }
        bypass = {
            has_completed_mission_task = nabhapakti_missions_task_3
        }
        allow = {
            current_ruler = {
                popularity >= 75
            }
            political_influence >= 35 #replace with tribal loyalty
        }
        on_completion = {
            trigger_event = me_nabhapakti.4
            show_as_tooltip = {
                add_centralization = centralization_huge
                add_political_influence = -35
                add_country_modifier = {
                    name = king_of_nepal
                    duration = -1
                }
                random_country_culture = {
                    limit = {
                        is_culture = kamarupi
                        is_integrated = no
                    }
                    set_country_culture_right = citizen
                }
                change_country_adjective = "nepali"
            }
        }
    }
    nabhapakti_missions_task_5 = { # Question of Capital
        icon = "task_economical"
        requires = { nabhapakti_missions_task_4 nabhapakti_missions_task_3 }
        allow = {
            stability >= 40
            c:NBP = {
                owns = p:4450
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti.5
            custom_tooltip = "choose_city_nepal"
        }
    }
    nabhapakti_missions_task_6 = { # Birthplace of Buddha
        icon = "task_religion"
        requires = { nabhapakti_missions_task_5 }
        allow = {
            custom_tooltip = {
                root.capital_scope.state = {
                    calc_true_if = {
                        amount >= 2 
                        state_improvement_religious_trigger = yes     
                    }
                }
                text = need_2_investments_tt
            } 
        }
        on_completion = {
            trigger_event = me_nabhapakti.6
            show_as_tooltip = {
                add_country_modifier = {
                    name = birth_of_buddha
                    days = -1
                }
                any_country = {
                    religion = buddhism
                    add_opinion = 25
                }
                any_country = {
                    OR = {
                        religion = jainism
                        religion = ajivika
                    }
                    add_opinion = -25
                }
                add_innovation = 1
                add_1_free_province_investments = yes
            }
        }
    }
    nabhapakti_missions_task_7 = { # Buddhists of Bengal
        icon = "task_economical"
        duration = 100
        requires = { nabhapakti_missions_task_6 }
        allow = {
            any_country = {
                tag = SMT
                opinion = {
                    target = root
                    value = 75
                }
            }
        }
        on_start = {
            trigger_event = me_nabhapakti.701
        }
        on_completion = {
            trigger_event = me_nabhapakti.7
            show_as_tooltip = {

            }
        }
    }
    nabhapakti_missions_task_8 = { # Buddhists of the Bonpo
        icon = "task_diplomatic"
        duration = 100
        requires = { nabhapakti_missions_task_6 }
        allow = {
            political_influence >= 25
        }
        on_start = {
            trigger_event = me_nabhapakti.801
        }
        on_completion = {
            trigger_event = me_nabhapakti.8
            show_as_tooltip = {

            }
        }
    }
    nabhapakti_missions_task_9 = { # Buddhists of Burma
        icon = "task_happiness"
        duration = 100
        requires = { nabhapakti_missions_task_6 }
        allow = {
            manpower > 3
        }
        on_start = {
            trigger_event = me_nabhapakti.901
        }
        on_completion = {
            trigger_event = me_nabhapakti.9
            show_as_tooltip = {

            }
        }
    }
    nabhapakti_missions_task_10 = { # Beacon of Buddhism
        icon = "task_atlas"
        requires = { nabhapakti_missions_task_7 nabhapakti_missions_task_8 nabhapakti_missions_task_9 }
        allow = {
            capital_scope = {
                has_building = temple_building
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti.10
            show_as_tooltip = {
                add_country_modifier = {
                    name = beacon_of_buddhism
                    days = -1
                }
            }
        }
    }
    nabhapakti_missions_task_11 = { # Matter of Malla
        icon = "task_expansion"
        requires = { nabhapakti_missions_task_19 }
        allow = {
            political_influence >= 35
            custom_tooltip = {
                c:MRY = {
                    has_opinion = {
                        modifier = opinion_insult
                        target = root
                    }
                }
                text = "nepal_maurya_insult_tt"
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti.11
            show_as_tooltip = {
                area:malla_area = {
                    every_area_province = {
                        add_claim = root
                    }
                }
            }
        }
    }
    nabhapakti_missions_task_12 = { # Great Ganges
        icon = "task_calm"
        requires = { nabhapakti_missions_task_11 nabhapakti_missions_task_20 nabhapakti_missions_task_21 }
        allow = {}
        on_completion = {
            trigger_event = me_nabhapakti.12
            show_as_tooltip = {

            }
        }
    }
    nabhapakti_missions_task_13 = { # Tibet Vassal
        icon = "task_diplomatic"
        requires = { nabhapakti_missions_task_10 }
        allow = {}
        on_completion = {
            trigger_event = me_nabhapakti.13
            show_as_tooltip = {

            }
        }
    }
    nabhapakti_missions_task_14 = { # Burma Vassal
        icon = "task_diplomatic"
        requires = { nabhapakti_missions_task_10 }
        allow = {}
        on_completion = {
            trigger_event = me_nabhapakti.14
            show_as_tooltip = {
                
            }
        }
    }
    nabhapakti_missions_task_15 = { # Bengal Vassal
        icon = "task_diplomatic"
        requires = { nabhapakti_missions_task_10 }
        allow = {}
        on_completion = {
            trigger_event = me_nabhapakti.15
            show_as_tooltip = {

            }
        }
    }
    nabhapakti_missions_task_16 = { # Poison Pill
        icon = "task_religion"
        requires = { nabhapakti_missions_task_19 }
        allow = {
            political_influence >= 25
            custom_tooltip = {
                any_country = {
                    is_subject_of = c:MRY
                    opinion = {
                        target = root
                        value >= 100
                    }
                }
                text = "nepal_mauryan_subjects_opinion_tt"
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti.16
            show_as_tooltip = {
                set_variable = {
                    name = poison_pill_nepal
                    days = -1
                }
            }
        }
    }
    nabhapakti_missions_task_17 = { # Kalinga Crisis
        icon = "task_calm"
    #    potential = {
    #        NOT = {
    #            exists = c:KAL
    #            owns_or_subject_owns_area = kalinga_area
    #        }
    #    }
        requires = { nabhapakti_missions_task_17 }
        highlight = {
            scope:province = {
                OR = {
                    is_in_area = kalinga_area
                    is_in_area = brahmani_area
                    is_in_area = radha_area
                }
            }
        }
        allow = {
            owns_or_subject_owns_area = kalinga_area
            owns_or_subject_owns_area = brahmani_area
            owns_or_subject_owns_area = radha_area
        }
        on_completion = {
            trigger_event = me_nabhapakti.17
            show_as_tooltip = {
            
            }
        }
    }
    nabhapakti_missions_task_18 = { # Informal Empire
        icon = "task_battle"
        requires = { nabhapakti_missions_task_13 nabhapakti_missions_task_14 nabhapakti_missions_task_15 }
        allow = {}
        on_completion = {
            trigger_event = me_nabhapakti.18
            show_as_tooltip = {
                change_government = informal_empire
            }
        }
    }
    nabhapakti_missions_task_19 = { # Belly of the Beast
        icon = "task_diplomatic"
        requires = { nabhapakti_missions_task_2 }
        allow = {
            root = {
                is_subject_of = c:MRY
            }
            stability >= 45
        }
        on_completion = {
            trigger_event = me_nabhapakti.19
            show_as_tooltip = {
                add_country_modifier = {
                    name = belly_of_the_beast
                    duration = 1825 
                }
            }
        }
    }
    nabhapakti_missions_task_20 = { # Claim Kamata
        icon = "task_battle"
        duration = 200
        requires = { nabhapakti_missions_task_19 }
        allow = {
            hidden:c:MRY.current_ruler = {
                is_friend = root.current_ruler
            }
        }
        on_start = {
            trigger_event = me_nabhapakti.20 #Maurya gives Itahar
            show_as_tooltip = {
                if = {
                    limit = {
                        p:7650 = {
                            owner = {
                                TAG = MRY
                            }
                        }
                    }
                    p:7650 = {
                        set_owned_by = c:NBP
                    }
                    add_treasury = -100
                }
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti.202 #War with Kamarupa
            show_as_tooltip = {
                if = {
                    limit = {
                        exists = c:KRP
                        c:KRP = { owns_or_subject_owns_area = kamata_area }
                    }
                    AND = {
                        declare_war_with_wargoal = {
                            war_goal = conquer_wargoal
                            province = 7654
                            target = c:KRP
                        }
                        if = {
                            limit = { alliance_with = c:MRY }
                            break_alliance = c:MRY
                            add_truce = {
                                target = c:MRY
                                duration = 1825 # 5 years
                            }
                        }
                    }
                }
            }
        }
    }
    nabhapakti_missions_task_21 = { # Benefits of Tribute
        icon = "task_economical"
        requires = { nabhapakti_missions_task_19 }
        allow = {
            custom_tooltip = {
                any_country = {
                    tag = MRY
                    opinion = {
                        target = root 
                        value >= 150
                    }
                }
                text = "nepali_maurya_opinion_tt"
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti.21
            show_as_tooltip = {
                add_country_modifier = {
                    name = mauryan_trust
                    days = 1825
                }
                add_2_free_province_investments = yes
                add_innovation = 2
            }
        }
    }
    nabhapakti_missions_task_22 = { # Influence the Indus
        icon = "task_economical"
        requires = { nabhapakti_missions_task_16 }
        allow = {}
        on_completion = {
            trigger_event = me_nabhapakti.22
            show_as_tooltip = {
            
            }
        }
    }
    nabhapakti_missions_task_23 = { # Call to the Jungle
        icon = "task_shiva"
        requires = { nabhapakti_missions_task_16 }
        allow = {}
        on_completion = {
            trigger_event = me_nabhapakti.23
            show_as_tooltip = {
            
            }
        }
    }
    nabhapakti_missions_task_24 = { # Buddha for the Greeks
        icon = "task_heracles"
    #   potential = {
    #        c:GED = {
    #            is_subject_of = c:MRY
    #        }
    #        c:ARS = {
    #            is_subject_of = c:MRY
    #        }
    #    }
        requires = { nabhapakti_missions_task_16 }
        allow = {}
        on_completion = {
            trigger_event = me_nabhapakti.24
            show_as_tooltip = {
            
            }
        }
    }
    nabhapakti_missions_task_25 = { # Sword of Buddhism
        icon = "task_conquest"
        requires = { nabhapakti_missions_task_22 nabhapakti_missions_task_23 nabhapakti_missions_task_24 nabhapakti_missions_task_12 }
        allow = {}
        on_completion = {
            trigger_event = me_nabhapakti.25
            show_as_tooltip = {
            
            }
        }
        final = yes
    }
    #Unlocked Missions
    nabhapakti_missions_task_r1 = { # Cities of Nepal
        icon = "task_diplomatic"
        requires = { nabhapakti_missions_task_3 }
        bypass = { has_completed_mission_task = nabhapakti_missions_task_4 }
        allow = {
            custom_tooltip = {
                c:NBP = {
                    any_owned_province = {
                        count >= 3
                        has_city_status = yes
                    }
                }
                text = "nepal_3_cities_tt"
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti_r.1
            show_as_tooltip = {

            }
        }
    }
    nabhapakti_missions_task_r2 = { #Defend Our Cities
        icon = "task_conquest"
        requires = { nabhapakti_missions_task_r1 }
        bypass = { has_completed_mission_task = nabhapakti_missions_task_4 }
        allow = {
            custom_tooltip = {
                c:NBP = {
                    any_owned_province = {
                        count >= 3
                        limit = {
                            has_city_status = yes
                        }
                        has_building = fortress_building
                    }
                }
                text = "nepal_3_cities_2_tt"
            }

        }
        on_completion = {
            trigger_event = me_nabhapakti_r.2
            show_as_tooltip = {
                add_country_modifier = {
                    id = war_stuff_nepal_and_build_cost
                    duration = -1
                }
            }
        }
    }
    nabhapakti_missions_task_r3 = { #Feed Our Cities
        icon = "task_political"
        requires = { nabhapakti_missions_task_r1 }
        bypass = { has_completed_mission_task = nabhapakti_missions_task_4 }
        allow = {
            custom_tooltip = {
                any_owned_province = {
                    limit = {
                        NOT = {
                            has_city_status = true
                        }
                        trade_goods = grain
                    }
                    has_building = basic_settlement_infratructure_building
                }
                text = "farming_nepal_tt"
            }
            capital_scope = {
                is_importing_trade_good = cattle
                is_importing_trade_good = grain
            }
            AND = {
                hidden:p:7489.state = {
                    calc_true_if = {
                        amount >= 2
                        state_improvement_civic_trigger = yes
                        state_improvement_oratory_trigger = yes
                        state_improvement_religious_trigger = yes
                        state_improvement_military_trigger = yes
                    }
                }
                hidden:p:4457.state = {
                    calc_true_if = {
                        amount >= 2
                        state_improvement_civic_trigger = yes
                        state_improvement_oratory_trigger = yes
                        state_improvement_religious_trigger = yes
                        state_improvement_military_trigger = yes
                    }
                }
                hidden:p:7656.state = {
                    calc_true_if = {
                        amount >= 1
                        state_improvement_civic_trigger = yes
                        state_improvement_oratory_trigger = yes
                        state_improvement_religious_trigger = yes
                        state_improvement_military_trigger = yes
                    }
                }
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti_r.3
            show_as_tooltip = {
                add_country_modifier = {
                    id = well_fed_cities_nepal
                    duration = 3650
                }
                add_2_free_province_investments = yes
            }
        }
    }
    nabhapakti_missions_task_r4 = { #The Second Vajjika League
        icon = "task_happiness"
        requires = { nabhapakti_missions_task_r2 nabhapakti_missions_task_r3 }
        bypass = { has_completed_mission_task = nabhapakti_missions_task_4 }
        allow = {
            custom_tooltip = {
                any_integrated_culture = {
                    is_culture = vrji
                }
                text = "nepal_vrji_acceptance_tt"
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti_r.4
            custom_tooltip = "form_vajjika_tt"
        }
    }
    nabhapakti_missions_task_r5 = { #Kingdom of Kosala
        icon = "task_expansion"
        requires = { nabhapakti_missions_task_r4 }
        bypass = { has_completed_mission_task = nabhapakti_missions_task_4 }
        allow = {
            owns_or_subject_owns_area = kosala_area
            owns_or_subject_owns_area = pancala_area
            owns_or_subject_owns_area = ahicchatra_area
        }
        on_completion = {
            trigger_event = me_nabhapakti_r.5
            show_as_tooltip = {
            
            }
        }
    }

    nabhapakti_missions_task_k1 = { #The Royal Capital
        icon = "task_artemis"
        requires = { nabhapakti_missions_task_4 }
        bypass = { has_completed_mission_task = nabhapakti_missions_task_3 }
        allow = {
            capital_scope = {
                has_building = library_building
                has_building = commerce_building
                has_building = academy_building
                has_building = aqueduct_building
                free_building_slots = 0 
                governor_policy = centralize_pops
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti_k.1
            show_as_tooltip = {
                add_province_modifier = {
                    id = migration_buff_and_building_slots
                    days = 365
                }
            }
            add_centralization = centralization_gargantuan
            add_stability = 5
        }
    }
    nabhapakti_missions_task_k2 = { #Fortify the Passes
        icon = "task_battle"
        requires = { nabhapakti_missions_task_k1 }
        bypass = { has_completed_mission_task = nabhapakti_missions_task_3 }
        allow = {
            p:5584 = {
                has_building = fortress_building
            }
            p:5587 = {
                has_building = fortress_building
            }
            p:5628 = {
                has_building = fortress_building
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti_k.2
            show_as_tooltip = {
                add_centralization = centralization_gargantuan
                add_1_free_province_investments = yes
            }
        }
    }
    nabhapakti_missions_task_k3 = { #Grow Our Capital
        icon = "task_shiva"
        requires = { nabhapakti_missions_task_k1 }
        bypass = { has_completed_mission_task = nabhapakti_missions_task_3 }
        allow = {
            capital_scope = {
                is_importing_trade_good = cattle
                is_importing_trade_good = cattle
                is_importing_trade_good = grain
                is_importing_trade_good = grain
            }
            custom_tooltip = {
                root.capital_scope.state = {
                    calc_true_if = {
                        amount >= 2 
                        state_improvement_oratory_trigger = yes     
                    }
                }
                text = need_2_investments_again_tt
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti_k.3
            show_as_tooltip = {
                add_centralization = centralization_gargantuan
                capital_scope = {
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = citizen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = freemen
                    create_state_pop = tribesmen
                }
                add_province_modifier = {
                    id = well_fed_capital
                    duration = 3650
                }
            }
        }
    }
    nabhapakti_missions_task_k4 = { #A Mountain Metropolis
        icon = "task_expansion"
        requires = { nabhapakti_missions_task_k3 nabhapakti_missions_task_k2 }
        bypass = { has_completed_mission_task = nabhapakti_missions_task_3 }
        allow = {
            capital_scope = {
                total_population >= 70
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti_k.4
            show_as_tooltip = {
                capital_scope = {
                    set_city_status = city_metropolis
                }
                capital_scope = {
                    add_province_modifier = {
                        id = mountain_metropolis
                        days = 1095
                    }
                }
                add_centralization = centralization_gargantuan
            }
        }
    }
    nabhapakti_missions_task_k5 = { #The Neo-Kirata Kingdom
        icon = "task_political"
        requires = { nabhapakti_missions_task_k4 }
        bypass = { has_completed_mission_task = nabhapakti_missions_task_3 }
        allow = {
            centralization >= 80
            current_ruler = {
                popularity >= 70
            }
        }
        on_completion = {
            trigger_event = me_nabhapakti_k.5
            show_as_tooltip = {
                change_government = aristocratic_monarchy
                change_country_name = neo_kirataed_up
                change_country_color = neo_kirata_copper
                add_legitimacy = legitimacy_huge
            }
        }
    }
}