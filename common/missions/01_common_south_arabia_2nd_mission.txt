south_arabia_mission = { # 2nd Mission tree for those who complete their first if one of : Saba, Qataba, Ma'in, Hadramut
	icon = cde_new_city_founded
	header = mission_image_carthage
	
	repeatable = no

    chance = {
		factor = 10
	}
	
	ai_chance = { factor = 10 }

	potential = { 
		# OR = { # commented out for testing reasons
		# 	has_completed_mission = saba_mission
		# 	has_completed_mission = qataba_mission
		# }
		NOT = {
			has_variable = south_arabia_mission_cooldown
		}
	}
	
	abort = {
        ai_mission_back_out_trigger = yes
    }

    on_potential = {}

    on_start = {
    	start_mission_ai_effect = yes
    }

    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = south_arabia_mission_cooldown
            days = 7300
        }
    }

    on_completion = {
    	complete_mission_effect = yes
		add_2_free_province_investments = yes
    }

	sa_task_1 = { # claims
		icon = task_economical
		duration = 180

		allow = {
			political_influence >= 30
		}

		on_completion = {
			trigger_event = { id = south_arabia.62 }
			show_as_tooltip = {
				mission_claim_region_effect = { REGION = punt_region }
				mission_claim_region_effect = { REGION = arabia_region }
			}
		}
	}

	sa_task_2 = { # start of punt conquest path
		icon = task_economical

		requires = {
			sa_task_17 sa_task_15
		}

		highlight = {
			scope:province = {
				NOT = {
					owner = root
				}
				is_in_region = punt_region
			}
		}

		allow = {
			owns_or_subject_owns_region = punt_region
		}

		on_completion = {
			trigger_event = { id = south_arabia.74 }
			show_as_tooltip = {
				add_country_modifier = {
					name = supremacy_punt
					duration = -1
				}
			}
		}
	}

	sa_task_3 = { # start of arabia conquest path
		icon = task_economical

		requires = {
			sa_task_1
		}

		highlight = {
			scope:province = {
				NOT = {
					owner = root
				}
				is_in_region = arabia_felix_region
			}
		}

		allow = {
			owns_or_subject_owns_region = arabia_felix_region
		}

		on_completion = {
			trigger_event = { id = south_arabia.63 }
			show_as_tooltip = {
				add_political_influence = 25
				add_military_experience = 25
				if = {
					limit = {
						c:AX1 = {
							is_subject_of = root
						}
					}
					hidden_effect = {
						release_subject = c:AX1
					}
					make_subject = {
						target = c:AX1
						type = feudatory
					}
				}
			}
		}
	}

	sa_task_4 = { # conuer the desert (Tasm and Jadis)
		icon = task_economical

		requires = {
			sa_task_3
		}

		highlight = {
			scope:province = {
				OR = {
					owner = c:AX3
					owner = c:AX0
				}
			}
		}

		allow = {
			owns_or_subject_owns = 8824 # Tasm Capital
			owns_or_subject_owns = 8831 # Jadis Capital
		}

		on_completion = {
			trigger_event = { id = south_arabia.64 }
			show_as_tooltip = {
				add_country_modifier = {
					name = conquered_part_of_arabia
					duration = 3650
					mode = extend
				}
				if = {
					limit = {
						p:8847 = {
							has_owner = no
						}
					}
					p:8847 = {
						set_owned_by = root
					}
				}
				if = {
					limit = {
						p:8848 = {
							has_owner = no
						}
					}
					p:8848 = {
						set_owned_by = root
					}
				}
				if = {
					limit = {
						p:8850 = {
							has_owner = no
						}
					}
					p:8850 = {
						set_owned_by = root
					}
				}
			}
		}
	}

	sa_task_5 = { # include jadisite and tasmite warriors in the army
		icon = task_economical

		requires = {
			sa_task_4
		}

		highlight = {
			scope:province = {
				OR = {
					province_id = 8824
					province_id = 8831
				}
			}
		}

		allow = {
			OR = {
				owns = 8824
				owns = 8831
				hidden:c:AX0 = { # Tasm
					is_subject_of = root
				}
				hidden:c:AX3 = { # Jadis
					is_subject_of = root
				}
			}
		}

		on_completion = {
			trigger_event = { id = south_arabia.65 }
			show_as_tooltip = {
				add_country_modifier = {
					name = jadisite_tasmite_warriors_in_army
					duration = -1
				}
			}
		}
	}

	sa_task_6 = { # conquer Thamud
		icon = task_economical

		requires = {
			sa_task_3
		}

		highlight = {
			scope:province = {
				OR = {
					owner = c:LHY
					owner = c:THD
				}
			}
		}

		allow = {
			owns = 7575
			owns = 4615
		}

		on_completion = {
			trigger_event = { id = south_arabia.66 }
			show_as_tooltip = {
				add_research = {
					technology = religious_tech
					value = 15
				}
				add_country_modifier = {
					name = conquered_part_of_arabia
					duration = 3650
					mode = extend
				}
			}
		}
	}

	sa_task_7 = { # The Black Stone (Ka'aba)
		icon = task_economical

		potential = { # if you become Israeli you cannot take the decision
			religion = arabian_pantheon
		}

		requires = {
			sa_task_6
		}

		highlight = {
			scope:province = {
				province_id = 7575
			}
		}

		allow = {
			owns = 7575
			hidden:p:7575 = {
				has_city_status = yes
				is_holy_site = yes
				custom_tooltip = {
					text = black_stone_in_province_tt
					any_province_treasure = {
						this = treasure:black_stone_of_kaaba
					}
				}
			}
		}

		on_completion = {
			trigger_event = { id = south_arabia.67 }
			show_as_tooltip = {
				p:7575 = {
					add_permanent_province_modifier = {
						name = kaaba_holy_city
						duration = -1
					}
				}
			}
		}
	}

	sa_task_8 = { # conquer oman
		icon = task_economical

		requires = {
			sa_task_3
		}

		highlight = {
			scope:province = {
				OR = {
					owner = c:AX4
					owner = c:MAK
				}
			}
		}

		allow = {
			owns = 5419
			owns = 7209
			owns = 8867
		}

		on_completion = {
			trigger_event = { id = south_arabia.68 }
			show_as_tooltip = {
				add_research = {
					technology = oratory_tech
					value = 15
				}
				add_country_modifier = {
					name = conquered_part_of_arabia
					duration = 3650
					mode = extend
				}
			}
		}
	}

	sa_task_9 = { # conquer gerrha
		icon = task_economical

		requires = {
			sa_task_8
		}

		highlight = {
			scope:province = {
				OR = {
					owner = c:TYO
					owner = c:GRH
				}
			}
		}

		allow = {
			owns = 7199
			owns = 7202
		}

		on_completion = {
			trigger_event = { id = south_arabia.69 }
			show_as_tooltip = {
				add_research = {
					technology = military_tech
					value = 15
				}
				add_country_modifier = {
					name = conquered_part_of_arabia
					duration = 3650
					mode = extend
				}
			}
		}
	}

	sa_task_10 = { # conquer nabataea
		icon = task_economical

		requires = {
			sa_task_6
		}

		highlight = {
			scope:province = {
				OR = {
					owner = c:NBT
				}
			}
		}

		allow = {
			owns = 729
		}

		on_completion = {
			trigger_event = { id = south_arabia.70 }
			show_as_tooltip = {
				add_research = {
					technology = civic_tech
					value = 15
				}
				add_country_modifier = {
					name = conquered_part_of_arabia
					duration = 3650
					mode = extend
				}
			}
		}
	}

	sa_task_11 = { # nabatean masonry
		icon = task_economical

		requires = {
			sa_task_10
		}

		highlight = {
			scope:province = {
				province_id = 729
			}
		}

		allow = {
			owns = 729
			custom_tooltip = {
				text = nabataeans_integrated_tt
				any_country_culture = {
					is_culture = nabatean
					is_integrated = yes
				}
			}
		}

		on_completion = {
			trigger_event = { id = south_arabia.71 }
			show_as_tooltip = {
				add_country_modifier = {
					name = nabatean_masonry
					duration = -1
				}
			}
		}
	}

	sa_task_12 = { # northern tribes
		icon = task_economical

		requires = {
			sa_task_6
		}

		highlight = {
			scope:province = {
				OR = {
					owner = c:AX5
					owner = c:QDA
				}
			}
		}

		allow = {
			owns = 8815
			owns = 4721
		}

		on_completion = {
			trigger_event = { id = south_arabia.72 }
			show_as_tooltip = {
				add_country_modifier = {
					name = conquered_part_of_arabia
					duration = 3650
					mode = extend
				}
				if = {
					limit = {
						p:8846 = {
							has_owner = no
						}
					}
					p:8846 = {
						set_owned_by = root
					}
				}
				if = {
					limit = {
						p:8845 = {
							has_owner = no
						}
					}
					p:8845 = {
						set_owned_by = root
					}
				}
				if = {
					limit = {
						p:8844 = {
							has_owner = no
						}
					}
					p:8844 = {
						set_owned_by = root
					}
				}
				if = {
					limit = {
						p:8816 = {
							has_owner = no
						}
					}
					p:8816 = {
						set_owned_by = root
					}
				}
			}
		}
	}

	sa_task_13 = { # fortify durnatha
		icon = task_economical

		requires = {
			sa_task_12
		}

		highlight = {
			scope:province = {
				province_id = 4721
			}
		}

		allow = {
			owns = 4721
			hidden:p:4721 = { has_building = fortress_building }
		}

		on_completion = {
			trigger_event = { id = south_arabia.73 }
			show_as_tooltip = {
				p:4721 = {
					add_province_modifier = {
						name = durnatha_fortified
						duration = -1
					}
				}
			}
		}
	}

	sa_task_14 = { # coast of axum
		icon = task_economical

		requires = {
			sa_task_1
		}

		highlight = {
			scope:province = {
				OR = {
					province_id = 7503
					province_id = 7502
				}
			}
		}

		allow = {
			owns = 7503
			owns = 7502
		}

		on_completion = {
			trigger_event = { id = south_arabia.75 }
			show_as_tooltip = {
				p:7503 = {
					while = {
						count = 3
						create_state_pop = citizen
					}
				}
				p:7502 = {
					while = {
						count = 3
						create_state_pop = citizen
					}
				}
			}
		}
	}

	sa_task_15 = { # into axum
		icon = task_economical

		requires = {
			sa_task_14
		}

		highlight = {
			scope:province = {
				OR = {
					province_id = 7506
					province_id = 8653
				}
			}
		}

		allow = {
			owns = 7506
			owns = 8653
		}

		on_completion = {
			trigger_event = { id = south_arabia.76 }
			custom_tooltip = convert_assimilate_parts_of_axum_tt
		}
	}

	sa_task_16 = { # horn of africa interior
		icon = task_economical

		requires = {
			sa_task_1
		}

		highlight = {
			scope:province = {
				NOT = {
					owner = root
				}
				OR = {
					is_in_area = upper_punt_area
					#is_in_area = elephas_area
					#is_in_area = zingis_area
					is_in_area = aromata_area
					is_in_area = mosylon_area
				}
			}
		}

		allow = { 
			owns_or_subject_owns_area = upper_punt_area
			#owns_or_subject_owns_area = elephas_area
			#owns_or_subject_owns_area = zingis_area
			owns_or_subject_owns_area = aromata_area
			owns_or_subject_owns_area = mosylon_area
		}

		on_completion = {
			trigger_event = { id = south_arabia.77 }
			custom_tooltip = free_colonised_territories_tt
		}
	}

	sa_task_17 = { # horn of africa interior
		icon = task_economical

		requires = {
			sa_task_16
		}

		highlight = {
			scope:province = {
				NOT = {
					owner = root
				}
				OR = {
					is_in_area = elephas_area
					is_in_area = zingis_area
				}
			}
		}

		allow = { 
			owns_or_subject_owns_area = elephas_area
			owns_or_subject_owns_area = zingis_area
		}

		on_completion = {
			trigger_event = { id = south_arabia.78 }
			show_as_tooltip = {
				add_treasury = 1000
				add_stability = 5
			}
		}
	}

	sa_task_18 = { # horn of africa interior
		icon = task_economical

		requires = {
			sa_task_10 sa_task_12 sa_task_9
		}

		final = yes

		allow = { 
			custom_tooltip = {
				text = formed_arabia_tt
				tag = ARB
			}
		}

		on_completion = {
			trigger_event = { id = south_arabia.79 }
			show_as_tooltip = {
				add_country_modifier = {
					name = kingdom_of_arabia
					duration = -1
				}
			}
		}
	}
}
