cyrene_missions_libya = {
    header = "kush_mission_header"
    icon = "cde_greek_desert_march"

    repeatable = no
    chance = 1000

    potential = {
        NOT = { has_variable = mission_cooldown_var }
        primary_culture = libyan
        root = c:CYR
    }

    abort = {}
    on_start = {
        start_mission_ai_effect = yes
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = mission_cooldown_var
            days = 7300
        }
    }
    on_completion = {
    }

    cyrene_missions_libya_task_1 = { # The Spoils of Victory
        icon = "task_conquest"
        allow = {
            war = no
        }
        on_completion = {
            trigger_event = me_cyr_libya.1
            show_as_tooltip = {
                add_treasury = 250
                add_political_influence = 50
                add_country_modifier = {
                    name = spoils_of_war
                    duration = 365
                }
                p:3360 = {
                    add_province_modifier = {
                        name = we_be_losers
                        duration = 365
                    }
                }
            }
        }
    }
    cyrene_missions_libya_task_2 = { # Foreign Customs
        icon = "task_diplomatic"
        requires = { cyrene_missions_libya_task_1 }
        allow = {
            custom_tooltip = {
                text = cyrene_1_libya_task_2.tt
                any_country_culture = {
                    is_culture = cyrenaican
                    OR = {
                        is_integrated = yes
                        has_country_culture_modifier = right_of_marriage
                    }
                }
            }
        }
        on_completion = {
            trigger_event = me_cyr_libya.2
            show_as_tooltip = {
                change_law = coin_minting_law
                change_law = increased_council_powers
            }
        }
    }
    cyrene_missions_libya_task_3 = { # Return to Old Ways
        icon = "task_happiness"
        requires = { cyrene_missions_libya_task_1 }
        allow = {
            custom_tooltip = {
                text = cyrene_1_libya_task_3.tt
                any_country_culture = {
                    is_culture = cyrenaican
                    OR = {
                        has_pop_type_right = slaves
                        has_pop_type_right = tribesmen
                    }
                }
            }
            custom_tooltip = {
                text = cyrene_1_libya_task_3_B.tt
                any_owned_province = {
                    is_in_region = cyrenaica_region
                    OR = {
                        governor_policy = religious_conversion 
                        governor_policy = cultural_assimilation  
                    } 
                }
            }
        }
        on_completion = {
            trigger_event = me_cyr_libya.3
            show_as_tooltip = {
                change_law = follow_the_strong_law
                change_law = tribal_decentralized_laws_2
                change_law = super_decentralized_law_two
            }
        }
    }
    cyrene_missions_libya_task_4 = { # The Capital at Barke
        icon = "task_economical"
        requires = { cyrene_missions_libya_task_2 cyrene_missions_libya_task_3 }
        allow = {
            p:3357 = {
                is_capital = yes
            }
            hidden:p:3357.state = {
                calc_true_if = {
                    amount >= 2
                    state_improvement_military_trigger = yes
                    state_improvement_civic_trigger = yes
                    state_improvement_oratory_trigger = yes
                    state_improvement_religious_trigger = yes
                }
            }
        }
        on_completion = {
            trigger_event = me_cyr_libya.4
            show_as_tooltip = {
                p:3357 = {
                    add_province_modifier = {
                        name = capital_of_libu
                        duration = -1
                    }
                }
                add_2_free_province_investments = yes
                while = {
                    count = 3
                    every_owned_province = {
                        limit = {
                            province_id = 3357
                        }
                        random_pops_in_province = {
                            limit = {
                                NOT = {pop_culture = root.culture}
                            }
                            set_pop_culture = root.culture
                        }
                    }
                }
            }
        }
    }
    cyrene_missions_libya_task_5 = { # Recruit Hellenic Advisors
        icon = "task_heracles"
        requires = { cyrene_missions_libya_task_2 }
        allow = {
            OR = {
                job_holder:office_arbitrator = {
                    has_culture_group = hellenic
                }
                job_holder:office_elder = {
                    has_culture_group = hellenic
                }
                job_holder:office_warchief = {
                    has_culture_group = hellenic
                }
                job_holder:office_bodyguard = {
                    has_culture_group = hellenic
                }
                job_holder:office_high_priest = {
                    has_culture_group = hellenic
                }
                job_holder:office_wise_person = {
                    has_culture_group = hellenic
                }
                job_holder:office_magistrate = {
                    has_culture_group = hellenic
                }
                job_holder:office_apothecary = {
                    has_culture_group = hellenic
                }                                              
            }
        }
        on_completion = {
            trigger_event = me_cyr_libya.5
            show_as_tooltip = {
                add_country_modifier = {
                    name = hellenic_advisors
                    duration = 1825
                }
            }
        }
    }
    cyrene_missions_libya_task_6 = { # Seek Common Ground
        icon = "task_apollo"
        duration = 180
        requires = { cyrene_missions_libya_task_5 }
        allow = {
            custom_tooltip = {
                any_pantheon_deity = {
                    count >= 1
                    deity_religion = roman_pantheon
                }
                text = "hellenic_libu_deity_tt"
            }
            invention = ruler_popularity_gain_inv_2
            treasury >= 75
            political_influence >= 25
        }
        on_start = {
            trigger_event = me_cyr_libya.600
        }
        on_completion = {
            trigger_event = me_cyr_libya.6
            show_as_tooltip = {
                custom_tooltip = special_event_tt
                custom_tooltip = barce_deity_tt
            }
        }
    }
    cyrene_missions_libya_task_7 = { # Hellenic Reconciliation
        icon = "task_atlas"
        requires = { cyrene_missions_libya_task_6 }
        allow = {
            p:3360 = {
                is_state_capital = yes
                total_population >= 25

            }
            hidden:p:3360.state = {
                calc_true_if = {
                    amount >= 1
                    state_improvement_military_trigger = yes
                    state_improvement_civic_trigger = yes
                    state_improvement_oratory_trigger = yes
                    state_improvement_religious_trigger = yes
                }
            }
            p:3344 = {
                is_state_capital = yes
                total_population >= 15
            }
            hidden:p:3344.state = {
                calc_true_if = {
                    amount >= 1
                    state_improvement_military_trigger = yes
                    state_improvement_civic_trigger = yes
                    state_improvement_oratory_trigger = yes
                    state_improvement_religious_trigger = yes
                }
            }
            custom_tooltip = {
                current_ruler = {
                    any_friend = { has_culture_group = hellenic }
                }
                text = hellenic_friend_tt
            }
            # Maybe add greek pop happiness check ?
        }
        on_completion = {
            trigger_event = me_cyr_libya.7
            show_as_tooltip = {
                add_4_free_province_investments = yes
                add_innovation = 2
                random_owned_province = {
                    limit = {
                        has_city_status = yes
                        province_dominant_culture_group = hellenic
                        is_in_area = cyrenaica_inferioris_area
                        NOT = { province_id = 3357 }
                    }
                    add_province_modifier = {
                        name = greek_reconciliation
                        duration = -1
                    }
                }
                random_owned_province = {
                    limit = {
                        has_city_status = yes
                        province_dominant_culture_group = hellenic
                        is_in_area = cyrenaica_superioris_area
                    }
                    add_province_modifier = {
                        name = greek_reconciliation
                        duration = -1
                    }
                }
            }
        }
    }
    cyrene_missions_libya_task_8 = { # Letters for the Libyan Tongue
        icon = "task_diplomatic"
        requires = { cyrene_missions_libya_task_5 }
        allow = {
            political_influence >= 50
            treasury >= 100
        }
        duration = 180
        on_start = {
            trigger_event = me_cyr_libya.8
        }
        on_completion = {
            trigger_event = me_cyr_libya.806
            custom_tooltip = libu_script_tt
        }
    }
    cyrene_missions_libya_task_9 = { # Kings of Eastern Libya
        icon = "task_political"
        requires = { cyrene_missions_libya_task_7 cyrene_missions_libya_task_8 }
        allow = {
            centralization >= 50
        }
        on_completion = {
            trigger_event = me_cyr_libya.9
            show_as_tooltip = {
                change_government = aristocratic_monarchy
                add_country_modifier = {
                    name = king_of_libu
                    duration = -1
                }
            }
        }
        final = yes
    }
    cyrene_missions_libya_task_10 = { # Plunder the Greek Cities
        icon = "task_artemis"
        requires = { cyrene_missions_libya_task_3 }
        allow = {
        
        }
        on_completion = {
            trigger_event = me_cyr_libya.10
            show_as_tooltip = {

            }
        }
    }
    cyrene_missions_libya_task_11 = { # Entice Libyan Settlers
        icon = "task_calm"
        requires = { cyrene_missions_libya_task_10 }
        allow = {}
        on_completion = {
            trigger_event = me_cyr_libya.11
            show_as_tooltip = {

            }
        }
    }
    cyrene_missions_libya_task_12 = { # Approach for Garamantes
        icon = "task_diplomatic"
        requires = { cyrene_missions_libya_task_11 }
        allow = {}
        on_completion = {
            trigger_event = me_cyr_libya.12
            show_as_tooltip = {

            }
        }
    }
    cyrene_missions_libya_task_13 = { # Camel War Parties
        icon = "task_battle"
        requires = { cyrene_missions_libya_task_10 }
        allow = {}
        on_completion = {
            trigger_event = me_cyr_libya.13
            show_as_tooltip = {

            }
        }
    }
    cyrene_missions_libya_task_14 = { # Raid the Cities of the West
        icon = "task_conquest"
        requires = { cyrene_missions_libya_task_13 }
        allow = {}
        on_completion = {
            trigger_event = me_cyr_libya.14
            show_as_tooltip = {

            }
        }
    }
    cyrene_missions_libya_task_15 = { # Terror from the Desert
        icon = "task_expansion"
        requires = { cyrene_missions_libya_task_14 }
        allow = {}
        on_completion = {
            trigger_event = me_cyr_libya.15
            show_as_tooltip = {

            }
        }
        final = yes
    }
}